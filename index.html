<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Saraiva Vision - Clínica Oftalmológica</title>
    <meta name="description" content="Clínica oftalmológica especializada em catarata, glaucoma, retina e cirurgia refrativa. Atendimento médico de qualidade em São Paulo." />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    
    <!-- SendPulse Live Chat com captura automática de UTM tags e variáveis customizadas -->
    <script type="text/javascript">
        // Helper para ler UTMs da URL (fallback manual caso necessário)
        (function attachUTMs() {
            const params = new URLSearchParams(window.location.search);
            window.__utm = {
                utm_source: params.get('utm_source') || undefined,
                utm_medium: params.get('utm_medium') || undefined,
                utm_campaign: params.get('utm_campaign') || undefined,
                utm_term: params.get('utm_term') || undefined,
                utm_content: params.get('utm_content') || undefined
            };
        })();

        // Função para sanitizar valores (evitar strings vazias)
        function sanitizeValue(value) {
            if (value === null || value === undefined || value === '') {
                return undefined;
            }
            return value;
        }

        // Defina as variáveis do assinante aqui (case-sensitive e existentes na Audience)
        window.oSpP = {
            // System vars (não precisam ser criadas)
            phone: sanitizeValue('+55 33 99960-1427'),
            email: sanitizeValue('saraivavision@gmail.com'),

            // Custom vars (precisam existir na Audience com a MESMA grafia)
            name: sanitizeValue('Visitante'),
            full_name: sanitizeValue('Visitante SaraivaVision'), // exibe imediatamente no Conversations
            city: sanitizeValue('Caratinga'),

            // Variáveis específicas do contexto médico-empresarial
            crm_id: sanitizeValue('PAC-' + new Date().getFullYear() + '-' + Date.now().toString().slice(-6)),
            clinic: sanitizeValue('SaraivaVision_MG'),
            source_detail: sanitizeValue('Website_LiveChat'),

            // Informações de localização
            state: sanitizeValue('MG'),
            country: sanitizeValue('BR'),

            // UTM parameters (capturados automaticamente pelo widget, mas incluídos para redundância)
            utm_source: sanitizeValue(window.__utm.utm_source),
            utm_medium: sanitizeValue(window.__utm.utm_medium),
            utm_campaign: sanitizeValue(window.__utm.utm_campaign),
            utm_term: sanitizeValue(window.__utm.utm_term),
            utm_content: sanitizeValue(window.__utm.utm_content),

            // Metadados adicionais
            page_url: sanitizeValue(window.location.href),
            referrer: sanitizeValue(document.referrer),
            timestamp: new Date().toISOString(),

            // Informações de sessão
            session_id: sanitizeValue('sess_' + Date.now()),
            visit_count: sanitizeValue(1),

            // Preferências do usuário
            language: sanitizeValue(navigator.language || 'pt-BR'),
            timezone: sanitizeValue(Intl.DateTimeFormat().resolvedOptions().timeZone),

            // Dados de marketing
            customer_segment: sanitizeValue('prospect'),
            acquisition_channel: sanitizeValue('organic')
        };

        // Log para debug (remover em produção)
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('SendPulse variables configured:', window.oSpP);
            console.log('UTM parameters captured:', window.__utm);
        }
    </script>
    
    <!-- Script do Live Chat do SendPulse (carregado APÓS as variáveis) -->
    <script src="https://cdn.pulse.is/livechat/loader.js" data-live-chat-id="68d52f7bf91669800d0923ac" async></script>
  </body>
</html>