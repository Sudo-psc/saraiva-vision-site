<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug WordPress Connection - Saraiva Vision</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .test-result {
        margin: 15px 0;
        padding: 15px;
        border-radius: 5px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #e2f3ff;
        color: #004085;
        border: 1px solid #b8daff;
      }
      button {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
      }
      .status {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 3px;
        font-weight: bold;
      }
      .status.online {
        background: #28a745;
        color: white;
      }
      .status.offline {
        background: #dc3545;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîç Debug Blog WordPress Connection</h1>
        <p>Testando a integra√ß√£o WordPress do blog SaraivaVision</p>
      </div>

      <div id="results"></div>

      <div>
        <button onclick="runAllTests()">üöÄ Executar Todos os Testes</button>
        <button onclick="testBasicConnection()">üì° Teste Conex√£o B√°sica</button>
        <button onclick="testFetchPosts()">üìö Buscar Posts</button>
        <button onclick="clearResults()">üßπ Limpar Resultados</button>
      </div>
    </div>

    <script>
      const API_URL = "http://localhost:8081/wp-json/wp/v2";
      const resultsDiv = document.getElementById("results");

      function addResult(type, title, content) {
        const div = document.createElement("div");
        div.className = `test-result ${type}`;
        div.innerHTML = `<h3>${title}</h3><div>${content}</div>`;
        resultsDiv.appendChild(div);
        div.scrollIntoView({ behavior: "smooth" });
      }

      function clearResults() {
        resultsDiv.innerHTML = "";
      }

      async function testBasicConnection() {
        addResult(
          "info",
          "üì° Testando Conex√£o B√°sica",
          "Verificando se o WordPress responde..."
        );

        try {
          const response = await fetch(`${API_URL}/posts?per_page=1`);

          if (response.ok) {
            const data = await response.json();
            addResult(
              "success",
              "‚úÖ Conex√£o OK",
              `
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Posts encontrados:</strong> ${data.length}</p>
                        <p><strong>WordPress funcionando:</strong> <span class="status online">ONLINE</span></p>
                    `
            );
            return true;
          } else {
            addResult(
              "error",
              "‚ùå Conex√£o Falhou",
              `
                        <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                        <p><strong>WordPress:</strong> <span class="status offline">OFFLINE</span></p>
                    `
            );
            return false;
          }
        } catch (error) {
          addResult(
            "error",
            "‚ùå Erro de Rede",
            `
                    <p><strong>Erro:</strong> ${error.message}</p>
                    <p><strong>WordPress:</strong> <span class="status offline">OFFLINE</span></p>
                    <p><strong>Poss√≠vel causa:</strong> Servidor n√£o est√° rodando ou CORS bloqueado</p>
                `
          );
          return false;
        }
      }

      async function testFetchPosts() {
        addResult(
          "info",
          "üìö Buscando Posts",
          "Testando busca completa de posts..."
        );

        try {
          const response = await fetch(
            `${API_URL}/posts?per_page=9&_embed=true&status=publish`
          );

          if (response.ok) {
            const posts = await response.json();

            const postsHtml = posts
              .map(
                (post, i) =>
                  `<li><strong>${i + 1}.</strong> ${post.title.rendered}</li>`
              )
              .join("");

            addResult(
              "success",
              "‚úÖ Posts Carregados",
              `
                        <p><strong>Total de posts:</strong> ${posts.length}</p>
                        <p><strong>Posts encontrados:</strong></p>
                        <ul>${postsHtml}</ul>
                    `
            );

            return posts;
          } else {
            addResult(
              "error",
              "‚ùå Falha ao Buscar Posts",
              `
                        <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                    `
            );
            return [];
          }
        } catch (error) {
          addResult(
            "error",
            "‚ùå Erro ao Buscar Posts",
            `
                    <p><strong>Erro:</strong> ${error.message}</p>
                `
          );
          return [];
        }
      }

      async function testWordPressFunction() {
        addResult(
          "info",
          "üîß Testando Fun√ß√£o WordPress",
          "Simulando checkWordPressConnection()..."
        );

        // Simular exatamente a fun√ß√£o do wordpress.js
        try {
          const response = await fetch(`${API_URL}/posts?per_page=1`);
          const isConnected = response.ok;

          if (isConnected) {
            addResult(
              "success",
              "‚úÖ checkWordPressConnection() Sucesso",
              `
                        <p><strong>Fun√ß√£o retornaria:</strong> true</p>
                        <p><strong>Blog deveria:</strong> Mostrar posts</p>
                    `
            );
          } else {
            addResult(
              "error",
              "‚ùå checkWordPressConnection() Falhou",
              `
                        <p><strong>Fun√ß√£o retornaria:</strong> false</p>
                        <p><strong>Blog mostraria:</strong> "Conte√∫do indispon√≠vel"</p>
                    `
            );
          }

          return isConnected;
        } catch (error) {
          addResult(
            "error",
            "‚ùå checkWordPressConnection() Erro",
            `
                    <p><strong>Fun√ß√£o retornaria:</strong> false</p>
                    <p><strong>Erro:</strong> ${error.message}</p>
                    <p><strong>Blog mostraria:</strong> "Conte√∫do indispon√≠vel"</p>
                `
          );
          return false;
        }
      }

      async function runAllTests() {
        clearResults();

        addResult(
          "info",
          "üöÄ Iniciando Diagn√≥stico Completo",
          `
                <p><strong>WordPress API:</strong> ${API_URL}</p>
                <p><strong>Origem:</strong> ${window.location.origin}</p>
                <p><strong>P√°gina atual:</strong> ${window.location.href}</p>
            `
        );

        // Executar testes em sequ√™ncia
        const basicOK = await testBasicConnection();

        if (basicOK) {
          await testFetchPosts();
          await testWordPressFunction();

          addResult(
            "success",
            "üéâ Diagn√≥stico Completo",
            `
                    <p><strong>Resultado:</strong> WordPress est√° funcionando perfeitamente!</p>
                    <p><strong>Se o blog mostra "Conte√∫do indispon√≠vel":</strong></p>
                    <ul>
                        <li>Verifique se o React est√° na mesma porta (3002)</li>
                        <li>Verifique o console do navegador para erros</li>
                        <li>Teste o blog diretamente: <a href="http://localhost:3002/blog" target="_blank">localhost:3002/blog</a></li>
                    </ul>
                `
          );
        } else {
          addResult(
            "error",
            "üî• Problema Detectado",
            `
                    <p><strong>WordPress mock n√£o est√° respondendo!</strong></p>
                    <p><strong>Para corrigir:</strong></p>
                    <ol>
                        <li>Verifique se o mock server est√° rodando: <code>node mock-wordpress-server.js</code></li>
                        <li>Verifique se a porta 8081 est√° livre</li>
                        <li>Teste diretamente: <a href="http://localhost:8081/wp-json/wp/v2/posts" target="_blank">localhost:8081/wp-json/wp/v2/posts</a></li>
                    </ol>
                `
          );
        }
      }

      // Auto-executar quando a p√°gina carrega
      window.addEventListener("load", () => {
        setTimeout(runAllTests, 500);
      });
    </script>
  </body>
</html>
