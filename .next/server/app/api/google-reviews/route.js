(()=>{var a={};a.id=939,a.ids=[939],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34684:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>D,patchFetch:()=>C,routeModule:()=>y,serverHooks:()=>B,workAsyncStorage:()=>z,workUnitAsyncStorage:()=>A});var d={};c.r(d),c.d(d,{GET:()=>x});var e=c(95736),f=c(9117),g=c(4044),h=c(39326),i=c(32324),j=c(261),k=c(54290),l=c(85328),m=c(38928),n=c(46595),o=c(3421),p=c(17679),q=c(41681),r=c(63446),s=c(86439),t=c(51356),u=c(10641);let v=a=>{if(!a)return null;let b=String(a).trim();return!b||b.toUpperCase().includes("PLACEHOLDER")?null:b},w=new Map;async function x(a){try{let{searchParams:b}=new URL(a.url),c=b.get("placeId"),d=parseInt(b.get("limit")||"5"),e=b.get("language")||"pt-BR",f=v(c)||v(process.env.GOOGLE_PLACE_ID)||v(process.env.VITE_GOOGLE_PLACE_ID)||"ChIJVUKww7WRugARF7u2lAe7BeE";if(!f)return console.error("Google Place ID not configured or using placeholder value"),u.NextResponse.json({success:!1,error:"Google Place ID not configured. Please check your environment variables."},{status:400});let g=process.env.GOOGLE_PLACES_API_KEY||process.env.GOOGLE_MAPS_API_KEY||process.env.VITE_GOOGLE_PLACES_API_KEY||process.env.VITE_GOOGLE_MAPS_API_KEY;if(!g||"your_google_maps_api_key_here"===g||"your_google_places_api_key_here"===g||!g.startsWith("AIza"))return console.error("Google Places API key not configured or using placeholder value"),u.NextResponse.json({success:!1,error:"Google Places API key not configured. Please check your environment variables."},{status:500});let h=`${f}-${d}-${e}`,i=w.get(h);if(i&&Date.now()-i.timestamp<3e5)return console.log("Google Reviews: Using cached data"),u.NextResponse.json({success:!0,data:i.result,timestamp:new Date().toISOString(),cached:!0});let j=new URLSearchParams({place_id:f,fields:"reviews,rating,user_ratings_total,name,opening_hours,url",language:e,key:g});console.log("Fetching reviews from Google Places API for place:",f);let k=new AbortController,l=setTimeout(()=>k.abort(),15e3),m=await fetch(`https://maps.googleapis.com/maps/api/place/details/json?${j.toString()}`,{method:"GET",headers:{Accept:"application/json","User-Agent":"SaraivaVision/1.0"},signal:k.signal});if(clearTimeout(l),!m.ok)throw Error(`Google Places API error: ${m.status} ${m.statusText}`);let n=m.headers.get("content-type");if(!n||!n.includes("application/json")){let a=await m.text();throw console.error("Non-JSON response from Google Places API:",a),Error("Invalid response format from Google Places API")}let o=await m.json();if("OK"!==o.status){if(console.error("Google Places API error:",o),"REQUEST_DENIED"===o.status)throw Error("API request denied. Please check your API key and ensure Places API is enabled.");if("INVALID_REQUEST"===o.status)throw Error("Invalid request. Please check the place ID format.");if("NOT_FOUND"===o.status)throw Error("Place not found. Please verify the place ID.");else if("OVER_QUERY_LIMIT"===o.status)throw Error("API quota exceeded. Please try again later.");else throw Error(`Google Places API error: ${o.status} - ${o.error_message||"Unknown error"}`)}let p=o.result,q=(p.reviews||[]).slice(0,d).map((a,b)=>({id:`places-${a.time||b}`,reviewer:{displayName:a.author_name||"Anonymous",profilePhotoUrl:a.profile_photo_url||null,isAnonymous:!a.author_name},starRating:a.rating||0,comment:a.text||"",createTime:a.time?new Date(1e3*a.time).toISOString():new Date().toISOString(),updateTime:a.time?new Date(1e3*a.time).toISOString():new Date().toISOString(),reviewReply:null,isRecent:function(a){if(!a)return!1;try{let b=new Date(1e3*a),c=new Date;return c.setDate(c.getDate()-30),b>=c}catch(a){return!1}}(a.time),hasResponse:!1,wordCount:a.text?a.text.split(" ").length:0,language:a.language||e,originalRating:a.rating,relativeTimeDescription:a.relative_time_description||null})),r=function(a,b){let c=b.user_ratings_total||a.length,d=b.rating||0,e={1:0,2:0,3:0,4:0,5:0},f=0,g=0;a.forEach(a=>{let b=Math.round(a.starRating);b>=1&&b<=5&&e[b]++,a.isRecent&&f++,g+=a.wordCount});let h=a.filter(a=>a.hasResponse).length,i=a.length>0?h/a.length*100:0,j=a.length>0?Math.round(g/a.length):0;return{overview:{totalReviews:c,averageRating:Math.round(10*d)/10,recentReviews:f,responseRate:Math.round(10*i)/10},distribution:e,sentiment:{positive:a.filter(a=>a.starRating>=4).length,neutral:a.filter(a=>3===a.starRating).length,negative:a.filter(a=>a.starRating<=2).length,positivePercentage:a.length>0?Math.round(a.filter(a=>a.starRating>=4).length/a.length*100):0,negativePercentage:a.length>0?Math.round(a.filter(a=>a.starRating<=2).length/a.length*100):0},engagement:{averageWordCount:j,reviewsWithPhotos:0,businessResponses:h,responseRate:Math.round(10*i)/10},period:{days:30,startDate:new Date(Date.now()-2592e6).toISOString(),endDate:new Date().toISOString()},lastUpdated:new Date().toISOString()}}(q,p),s={reviews:q,stats:r,place:{id:f,name:p.name||"Cl\xednica Saraiva Vision",rating:p.rating||0,userRatingCount:p.user_ratings_total||0,url:p.url||`https://www.google.com/maps/place/?q=place_id:${f}`,openingHours:p.opening_hours||null},pagination:{total:q.length,limit:d,offset:0,hasMore:!1},metadata:{fetchedAt:new Date().toISOString(),source:"google-places-api",placeId:f,placeName:p.name||"Unknown",totalReviews:p.user_ratings_total||0,averageRating:p.rating||0}};return w.set(h,{result:s,timestamp:Date.now()}),console.log(`Successfully fetched ${q.length} reviews from Google Places API`),u.NextResponse.json({success:!0,data:s,timestamp:new Date().toISOString(),cached:!1})}catch(a){return console.error("Google Places Reviews API Error:",a),u.NextResponse.json({success:!1,error:a instanceof Error?a.message:"Internal server error",timestamp:new Date().toISOString()},{status:500})}}let y=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/google-reviews/route",pathname:"/api/google-reviews",filename:"route",bundlePath:"app/api/google-reviews/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/home/saraiva-vision-site/app/api/google-reviews/route.ts",nextConfigOutput:"standalone",userland:d}),{workAsyncStorage:z,workUnitAsyncStorage:A,serverHooks:B}=y;function C(){return(0,g.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:A})}async function D(a,b,c){var d;let e="/api/google-reviews/route";"/index"===e&&(e="/");let g=await y.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!x){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||y.isDev||x||(G="/index"===(G=D)?"/":G);let H=!0===y.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>y.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>y.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await y.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await y.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await y.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},96487:()=>{}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[586,692],()=>b(b.s=34684));module.exports=c})();