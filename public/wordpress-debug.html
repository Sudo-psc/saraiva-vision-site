<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WordPress Debug - SaraivaVision</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .status {
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        font-weight: bold;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      #output {
        background: #fff;
        padding: 20px;
        border-radius: 5px;
        border: 1px solid #ddd;
        white-space: pre-wrap;
      }
      button {
        padding: 10px 20px;
        margin: 10px 5px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
    </style>
  </head>
  <body>
    <h1>üîç WordPress Integration Debug - SaraivaVision</h1>

    <div class="info">
      <strong>Info:</strong> Esta p√°gina testa a integra√ß√£o WordPress headless
      do site SaraivaVision. Abra o DevTools (F12) para ver logs detalhados.
    </div>

    <div>
      <button onclick="testWordPressConnection()">
        Testar Conex√£o WordPress
      </button>
      <button onclick="testFetchPosts()">Testar Busca de Posts</button>
      <button onclick="testFetchCategories()">Testar Categorias</button>
      <button onclick="clearOutput()">Limpar Output</button>
    </div>

    <h2>Output:</h2>
    <div id="output">Clique em um bot√£o acima para executar os testes...</div>

    <script type="module">
      // Importar as fun√ß√µes do WordPress
      import {
        checkWordPressConnection,
        fetchPosts,
        fetchCategories,
        wordpressConfig,
      } from "/src/lib/wordpress.js";

      // Fazer as fun√ß√µes dispon√≠veis globalmente para os bot√µes
      window.checkWordPressConnection = checkWordPressConnection;
      window.fetchPosts = fetchPosts;
      window.fetchCategories = fetchCategories;
      window.wordpressConfig = wordpressConfig;

      const output = document.getElementById("output");

      function log(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const formattedMessage = `[${timestamp}] ${message}\n`;
        output.textContent += formattedMessage;

        // Tamb√©m log no console
        console.log(`[WordPress Debug] ${message}`);
      }

      window.log = log;

      window.clearOutput = () => {
        output.textContent = "";
      };

      // Teste de conex√£o
      window.testWordPressConnection = async () => {
        log("=== TESTE DE CONEX√ÉO WORDPRESS ===");
        log(`Configura√ß√£o atual: ${JSON.stringify(wordpressConfig, null, 2)}`);

        try {
          log("Testando conex√£o com WordPress...");
          const isConnected = await checkWordPressConnection();

          if (isConnected) {
            log("‚úÖ WordPress API est√° dispon√≠vel", "success");
          } else {
            log("‚ùå WordPress API n√£o est√° dispon√≠vel", "error");
          }
        } catch (error) {
          log(`‚ùå Erro ao testar conex√£o: ${error.message}`, "error");
          console.error("WordPress connection test error:", error);
        }
      };

      // Teste de posts
      window.testFetchPosts = async () => {
        log("=== TESTE DE BUSCA DE POSTS ===");

        try {
          log("Buscando posts...");
          const posts = await fetchPosts({ per_page: 3 });

          if (posts && posts.length > 0) {
            log(`‚úÖ ${posts.length} posts encontrados`, "success");
            posts.forEach((post, index) => {
              log(
                `  ${index + 1}. ${post.title?.rendered || "Sem t√≠tulo"} (${
                  post.slug
                })`
              );
            });
          } else {
            log("‚ö†Ô∏è Nenhum post encontrado", "warning");
          }
        } catch (error) {
          log(`‚ùå Erro ao buscar posts: ${error.message}`, "error");
          console.error("Fetch posts error:", error);
        }
      };

      // Teste de categorias
      window.testFetchCategories = async () => {
        log("=== TESTE DE BUSCA DE CATEGORIAS ===");

        try {
          log("Buscando categorias...");
          const categories = await fetchCategories();

          if (categories && categories.length > 0) {
            log(`‚úÖ ${categories.length} categorias encontradas`, "success");
            categories.forEach((category, index) => {
              log(`  ${index + 1}. ${category.name} (${category.slug})`);
            });
          } else {
            log("‚ö†Ô∏è Nenhuma categoria encontrada", "warning");
          }
        } catch (error) {
          log(`‚ùå Erro ao buscar categorias: ${error.message}`, "error");
          console.error("Fetch categories error:", error);
        }
      };

      // Executar teste inicial de conex√£o automaticamente
      log("P√°gina carregada. Executando teste inicial...");
      setTimeout(() => {
        testWordPressConnection();
      }, 1000);
    </script>
  </body>
</html>
