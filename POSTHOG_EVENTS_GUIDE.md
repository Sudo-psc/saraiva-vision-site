# Guia Pr√°tico - Enviando Eventos com PostHog

## üéØ Vis√£o Geral

Este guia mostra como implementar e enviar eventos personalizados usando o PostHog na aplica√ß√£o Saraiva Vision. Inclui exemplos pr√°ticos e componentes de teste.

## üöÄ Componentes de Teste Criados

### 1. **PostHogEventTesting.jsx**
Interface completa para testar todos os tipos de eventos:
- ‚úÖ Eventos personalizados com propriedades JSON
- ‚úÖ Eventos diretos do PostHog
- ‚úÖ Eventos espec√≠ficos da Saraiva Vision
- ‚úÖ A√ß√µes do usu√°rio
- ‚úÖ Eventos de neg√≥cio
- ‚úÖ Convers√µes
- ‚úÖ Log em tempo real dos eventos enviados

### 2. **AutoEventExamples.jsx**
Demonstra√ß√£o de eventos autom√°ticos:
- ‚úÖ Rastreamento de visibilidade (Intersection Observer)
- ‚úÖ Rastreamento de cliques autom√°tico
- ‚úÖ Rastreamento de formul√°rios
- ‚úÖ M√©tricas de performance
- ‚úÖ Comportamento do usu√°rio (mouse, teclado, idle)

## üìù Como Enviar Eventos

### 1. **Evento Simples**
```javascript
import { usePostHog } from '@/hooks/usePostHog';

const { trackEvent } = usePostHog();

// Evento b√°sico
trackEvent('meu_evento', {
  propriedade: 'valor',
  numero: 123,
  timestamp: new Date().toISOString()
});
```

### 2. **Evento Direto PostHog**
```javascript
import { usePostHog } from 'posthog-js/react';

const posthog = usePostHog();

// Chamada direta
posthog?.capture('meu_evento', { 
  propriedade: 'valor' 
});
```

### 3. **Eventos Espec√≠ficos da Saraiva Vision**
```javascript
import { useSaraivaTracking } from '@/hooks/usePostHog';

const {
  trackAppointmentRequest,
  trackServiceView,
  trackContactInteraction,
  trackBlogEngagement,
  trackInstagramInteraction,
  trackAccessibilityUsage,
  trackSearchQuery,
  trackNewsletterSignup
} = useSaraivaTracking();

// Exemplos de uso
trackAppointmentRequest('consulta', 'whatsapp');
trackServiceView('catarata', 'Cirurgia de Catarata');
trackContactInteraction('whatsapp', 'widget');
trackBlogEngagement('post-slug', 'view');
trackInstagramInteraction('click', 'post-123');
trackAccessibilityUsage('font_size', true);
trackSearchQuery('oftalmologista', 5);
trackNewsletterSignup('user@email.com', 'footer');
```

## üéõÔ∏è Tipos de Eventos Implementados

### **Eventos Autom√°ticos** (Capturados automaticamente)
- ‚úÖ **Pageviews** - Visualiza√ß√µes de p√°gina
- ‚úÖ **Clicks** - Cliques em elementos
- ‚úÖ **Form Submissions** - Envios de formul√°rio
- ‚úÖ **Session Recording** - Grava√ß√£o de sess√£o

### **Eventos de Neg√≥cio**
```javascript
// Agendamento de consulta
trackAppointmentRequest('catarata', 'form');

// Visualiza√ß√£o de servi√ßo
trackServiceView('lasik', 'Cirurgia LASIK');

// Intera√ß√£o de contato
trackContactInteraction('phone', 'header_button');

// Verifica√ß√£o de conv√™nio
trackBusinessEvent('insurance_checked', {
  provider: 'unimed',
  covered: true
});
```

### **Eventos de Convers√£o**
```javascript
// Solicita√ß√£o de agendamento
trackConversion('appointment_request', 1);

// Liga√ß√£o telef√¥nica
trackConversion('phone_call', 1);

// Download de material
trackConversion('brochure_download', 1);

// Consulta realizada (com valor)
trackConversion('consultation_completed', 350);
```

### **A√ß√µes do Usu√°rio**
```javascript
// Clique em bot√£o
trackUserAction('button_click', {
  button_id: 'cta_main',
  button_text: 'Agendar Consulta'
});

// Scroll na p√°gina
trackUserAction('scroll_depth', { depth: '75%' });

// Reprodu√ß√£o de v√≠deo
trackUserAction('video_play', { video_id: 'intro_video' });

// Compartilhamento
trackUserAction('share', { platform: 'whatsapp' });
```

## üîß Implementa√ß√£o em Componentes Existentes

### **1. Bot√£o com Tracking**
```jsx
import { useSaraivaTracking } from '@/hooks/usePostHog';

const AppointmentButton = () => {
  const { trackAppointmentRequest } = useSaraivaTracking();

  const handleClick = () => {
    trackAppointmentRequest('consulta_geral', 'cta_button');
    // ... l√≥gica do agendamento
  };

  return (
    <Button onClick={handleClick}>
      Agendar Consulta
    </Button>
  );
};
```

### **2. Formul√°rio com Tracking**
```jsx
import { usePostHog } from '@/hooks/usePostHog';

const ContactForm = () => {
  const { trackEvent } = usePostHog();

  const handleSubmit = (formData) => {
    trackEvent('contact_form_submit', {
      form_fields: Object.keys(formData),
      completion_rate: calculateCompletionRate(formData),
      source: 'contact_page'
    });
    
    // ... enviar formul√°rio
  };

  const handleFieldChange = (field, value) => {
    trackEvent('form_field_interaction', {
      field_name: field,
      field_value_length: value.length,
      form_id: 'contact_form'
    });
  };

  return (
    <form onSubmit={handleSubmit}>
      {/* campos do formul√°rio */}
    </form>
  );
};
```

### **3. Componente com Visibilidade**
```jsx
import { useEffect, useRef } from 'react';
import { usePostHog } from '@/hooks/usePostHog';

const ServiceCard = ({ service }) => {
  const { trackServiceView } = useSaraivaTracking();
  const cardRef = useRef(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          trackServiceView(service.id, service.name);
        }
      },
      { threshold: 0.5 }
    );

    if (cardRef.current) {
      observer.observe(cardRef.current);
    }

    return () => observer.disconnect();
  }, [service, trackServiceView]);

  return (
    <div ref={cardRef} className="service-card">
      {/* conte√∫do do card */}
    </div>
  );
};
```

### **4. Widget com Tracking**
```jsx
import { useSaraivaTracking } from '@/hooks/usePostHog';

const WhatsAppWidget = () => {
  const { trackContactInteraction } = useSaraivaTracking();

  const handleWhatsAppClick = () => {
    trackContactInteraction('whatsapp', 'widget');
    
    // Enhanced tracking
    trackEvent('whatsapp_click', {
      source: 'widget',
      business_hours: isBusinessHours(),
      widget_position: 'bottom_right',
      user_type: getUserType()
    });

    // ... abrir WhatsApp
  };

  return (
    <button onClick={handleWhatsAppClick}>
      WhatsApp
    </button>
  );
};
```

## üìä Eventos Espec√≠ficos por Se√ß√£o

### **Homepage**
```javascript
// Hero section
trackEvent('hero_cta_click', { cta_text: 'Agendar Consulta' });

// Services section
trackServiceView('service_id', 'Service Name');

// Testimonials
trackEvent('testimonial_viewed', { testimonial_id: 'test_123' });

// Instagram feed
trackInstagramInteraction('view', 'post_id');
```

### **P√°gina de Servi√ßos**
```javascript
// Service detail view
trackServiceView('catarata', 'Cirurgia de Catarata');

// Price inquiry
trackEvent('price_inquiry', { service: 'lasik' });

// Appointment request
trackAppointmentRequest('refracao', 'service_page');
```

### **Blog**
```javascript
// Post view
trackBlogEngagement('post-slug', 'view');

// Reading time
trackEvent('reading_time', {
  post_slug: 'post-slug',
  time_spent: 120, // seconds
  scroll_depth: '80%'
});

// Share
trackBlogEngagement('post-slug', 'share');
```

### **Contato**
```javascript
// Form interaction
trackEvent('contact_form_start', { source: 'contact_page' });

// Form completion
trackEvent('contact_form_submit', {
  fields_completed: ['name', 'email', 'message'],
  completion_rate: 1.0
});

// Contact method selection
trackContactInteraction('phone', 'contact_page');
```

## üß™ Como Testar os Eventos

### **1. Usar o Componente de Teste**
```jsx
import PostHogEventTesting from '@/components/PostHogEventTesting';

// Adicionar em uma p√°gina para testar
<PostHogEventTesting />
```

### **2. Verificar no Console (Desenvolvimento)**
```javascript
// PostHog debug est√° ativo em desenvolvimento
// Eventos aparecem no console do navegador
```

### **3. Verificar no Dashboard PostHog**
1. Acesse o dashboard do PostHog
2. V√° para "Events" ou "Live Events"
3. Veja os eventos chegando em tempo real

### **4. Usar o Browser DevTools**
```javascript
// No console do navegador
window.posthog.capture('test_event', { test: true });

// Verificar se PostHog est√° carregado
console.log(window.posthog);
```

## üìà Melhores Pr√°ticas

### **1. Nomenclatura de Eventos**
```javascript
// ‚úÖ Bom - descritivo e consistente
trackEvent('appointment_request_submitted', { service: 'catarata' });

// ‚ùå Ruim - vago e inconsistente
trackEvent('click', { thing: 'button' });
```

### **2. Propriedades √öteis**
```javascript
trackEvent('user_action', {
  // Contexto
  page: window.location.pathname,
  section: 'hero',
  
  // Timing
  timestamp: new Date().toISOString(),
  session_duration: getSessionDuration(),
  
  // User info
  user_type: 'visitor', // or 'patient', 'returning'
  device_type: 'mobile', // or 'desktop', 'tablet'
  
  // Business context
  service_interest: 'catarata',
  conversion_funnel_step: 'awareness'
});
```

### **3. Evitar Dados Sens√≠veis**
```javascript
// ‚úÖ Bom - dados anonimizados
trackEvent('form_submit', {
  email_domain: email.split('@')[1],
  phone_area_code: phone.substring(0, 2)
});

// ‚ùå Ruim - dados pessoais
trackEvent('form_submit', {
  email: 'user@email.com',
  phone: '11999999999'
});
```

### **4. Batch Events para Performance**
```javascript
import { posthogUtils } from '@/utils/posthogConfig';

// Enviar m√∫ltiplos eventos de uma vez
posthogUtils.batchTrack([
  { event: 'page_view', properties: { page: '/services' } },
  { event: 'service_viewed', properties: { service: 'catarata' } },
  { event: 'cta_impression', properties: { cta_id: 'book_now' } }
]);
```

## üîç Debug e Troubleshooting

### **Verificar se PostHog est√° Carregado**
```javascript
import { posthogUtils } from '@/utils/posthogConfig';

if (posthogUtils.isAvailable()) {
  console.log('PostHog est√° funcionando!');
} else {
  console.log('PostHog n√£o est√° carregado');
}
```

### **Opera√ß√µes Seguras**
```javascript
// Sempre use opera√ß√µes seguras para evitar erros
posthogUtils.safeExecute((posthog) => {
  posthog.capture('my_event', { property: 'value' });
});
```

### **Verificar Feature Flags**
```javascript
import { posthogUtils } from '@/utils/posthogConfig';

const flags = posthogUtils.getFeatureFlags();
console.log('Feature flags ativas:', flags);
```

## üéâ Resultado Final

Com esta implementa√ß√£o voc√™ tem:

- ‚úÖ **Sistema completo de eventos** - Autom√°ticos e manuais
- ‚úÖ **Componentes de teste** - Interface para testar todos os eventos
- ‚úÖ **Hooks personalizados** - F√°cil integra√ß√£o em qualquer componente
- ‚úÖ **Eventos espec√≠ficos** - Focados no neg√≥cio da Saraiva Vision
- ‚úÖ **Tracking autom√°tico** - Visibilidade, cliques, formul√°rios
- ‚úÖ **Performance tracking** - M√©tricas de carregamento
- ‚úÖ **Comportamento do usu√°rio** - Mouse, teclado, navega√ß√£o
- ‚úÖ **Privacidade garantida** - Dados anonimizados e seguros

Agora voc√™ pode capturar insights detalhados sobre como os usu√°rios interagem com a aplica√ß√£o e otimizar a experi√™ncia baseada em dados reais!